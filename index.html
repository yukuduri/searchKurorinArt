<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=0.5,user-scalable=yes,initial-scale=1.0" />
    <meta name="description" content="くろりんアートを簡単に検索するためのツールです。">
    <title>くろりんアート簡単検索ツール</title> 
    <link rel="stylesheet" href="css/normalize.css">
    <link href="https://fonts.googleapis.com/css?family=M+PLUS+1p" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Sawarabi+Mincho" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-1.7.2.min.js"></script>
    <script>
      const test = () => {
        console.log('arrow function: OK');
        class TestClass {
          constructor(msg){
            this.msg = msg;
          }
          print(){
            console.log(this.msg);
          }
          alert(){
            alert('正常に動作しています');
          }
        }
        const t1 = new TestClass('class constructor: OK');
        t1.print();
        t1.alert();
      }
      
      
      
      function* genSwitch(contents){
        const contentsButton = "." + contents + ".button";
        const contentsName = "div." + contents; 
        while(true){
          $(contentsName).slideUp();
          $(contentsButton).html("開く ▼");
          yield;
          $(contentsName).slideDown();
          $(contentsButton).html("閉じる ▲");
          yield;
        }
      }

      const switchViewManual = genSwitch('manual');
      const nextViewManual = () => {
        switchViewManual.next();
      }
      
      const switchViewDate = genSwitch('date');
      const nextViewDate= () => {
        switchViewDate.next();
      }
      
      const switchViewFree = genSwitch('free');
      const nextViewFree= () => {
        switchViewFree.next();
      }
      

      
      class Search {
        constructor(){
          this.tag = $('input[name="tag"]').val();
          this.userName = $('input[name="userName"]').val().replace(/[@＠]/g, '').replace(/[　 ]$/, '');
          this.word = $('input[name="word"]').val();
          this.wordIsAnd = $('input[name="wordIsAnd"]').val();
          //this.dateIsChecked = $('input[name=date]:checked').val();
          this.beginDate = $('input[name="beginDate"]').val();
          this.endDate = $('input[name="endDate"]').val();
          this.option = $('select[name="option"]').val();
          //console.log(this.dateIsChecked);
          console.log(this.beginDate);
          this
        }
        
        jumpURL(){
          const userNameAry = this.userName.split(/[ 　]/);
          const wordAry = this.word.split(/[ 　]/);
          let URL = 'https://twitter.com/search?src=typd&q=';
          URL += this.tag;
          
          if(this.word != ''){
            URL += ' (' + wordAry[0] + ') ';
            if (wordAry.length > 1){
              for (let i = 1; i < wordAry.length; i++){
                if (this.wordIsAnd == 0) URL += 'OR';
                URL += ' (' + wordAry[i] + ') ';
              }
            }
          }
          
          if(this.userName != ''){
            URL += ' (from:' + userNameAry[0] + ')';
            if (userNameAry.length > 1){
              for (let i = 1; i < userNameAry.length; i++){
                URL += 'OR(from:' + userNameAry[i] + ')';
              }
            }
          }
          //if(dateIsChecked){}
          if(this.beginDate != ''){
            URL += ' since:' + this.beginDate;
          }
          if(this.endDate != ''){
            URL += ' until:' + this.endDate;
          }
          
          switch (this.option){
            case 'wadai':
              URL += '&vertical=default';
              break;
            case 'images':
              URL += '&f=images';
              break;
            case 'videos':
              URL += '&f=videos';
              break;
            case 'all':
            default:
              URL += '&f=tweets';
              
          }
          
          URL = URL.replace(/[#＃♯]/g, '#');  //ハッシュタグ#の置換
          URL = encodeURI(URL);             //URLエンコード
          URL = URL.replace(/#/g, '%23');   //ハッシュタグ#のURLエンコード
          console.log(URL);
          window.open(URL);
        }
      }
      
      
      
      const run = () => {
        const search = new Search();
        search.jumpURL();
      }
      
      const reset = () => {
        if(window.confirm('入力内容をすべてリセットしてよろしいですか？')){
          location.href='/'
        }
      }
      
      $ (onLoad => {
        switchViewDate.next();
        switchViewFree.next();
      });

    </script>
  </head>

  <body>
    <noscript><section class="item footer"><h1 class="heading">このサイトの正常な表示・動作には、JavaScriptが必要です。<br>JavaScript対応のブラウザで、JavaScriptを有効にしてから再度アクセスしてください。<br>©2019 yukuduri</h1></section></noscript>
    <header class="item header">
      <h1>くろりんアート簡単検索ツール ver0.9</h1>
    </header>
    
    <section class="item">
      <p>Twitterで「#くろりんアート」を簡単に検索するためのツールです。 <br><br>
      </p>
      <h3 class="block">マニュアル</h3><p class="manual button" onclick="nextViewManual()">閉じる ▲</p>
      
      <div class="manual item">
        <hr>
        
        <h3>ユーザー指定(省略可)</h3>
        <p>
          ツイートしたユーザーを絞って検索します。検索に使えるのは、スクリーンネームのみです。<br>
          （スクリーンネームは、例えば「@durian3960」など。「@」はあってもなくてもいいです。）<br>
          空白で区切って複数のスクリーンネームを入力すると、それらのアカウントがツイートした投稿を一覧できます<br>
        </p>
        
        <hr>
        
        <h3>日付の指定(省略可)</h3>
        <p>
          検索するツイートの期間を指定します。どちらか片方のみの指定でも問題ありません。
        </p>
        
        <hr>
        
        <h3>フリーワード設定(省略可)</h3>
        <p>
          キーワードを入れて更に絞り込みたいときに使用します。ハッシュタグ(#)も使用可能です<br><br>
          スペースで区切ると、複数のワードをAND検索もしくはOR検索します。<br>
          AND検索：すべて含むものを検索<br>
          OR検索：いずれかを含むものを検索<br>
          AND検索とOR検索を切り替えることもできます。単語欄の下のスイッチで切り替えてください<br>
        </p>
        
        <hr>
        
        <h3>検索オプション</h3>
        <p>
          検索する対象ツイートの絞り込みができます。
        </p>

        <hr>
        
        <h3>お問い合わせ</h3>
        <p>
          本サイトについての不具合やご意見、ご不明な点等ございましたら、<a href="https://twitter.com/durian3960" target="_blank">サイト運営のTwitter</a>まで。
        </p>

        <hr>
      </div>

      <hr>
      <form name="searcher">
        検索対象タグ（編集不可）：<input type="text" name="tag" value="#くろりんアート" readonly><br><br>
        ユーザー指定：<input type="text" name="userName" placeholder="省略可"><br><br>
        日付の指定<p id="date" class="date button" onclick="nextViewDate()">閉じる ▲</p><br>
        <div class="date item">
          <!--<label><input type="checkbox"　name="date" value="1" checked="checked">日付指定する</label><br><br>-->
          <input type="date" name="beginDate">から<br>
          <input type="date" name="endDate">まで<br>
        </div> 
        フリーワード設定<p id="date" class="free button" onclick="nextViewFree()">閉じる ▲</p><br>
        <div class="free item">
          単語：<input type="text" name="word" placeholder="省略可"><br>

          OR検索 <input type="range" name="wordIsAnd" min="0" max="1" value="1"> AND検索
        </div>
        
        検索オプション:
        <select name="option">
          <option value="wadai">話題のツイート</option>
          <option value="all" selected>すべてのツイート</option>
          <option value="images">画像のみ</option>
          <option value="videos">動画のみ</option>
        </select>
      </form>
      
      <p class="button" onclick="run()">検索</p><p class="button reset" onclick="reset()">リセット</p>
      
      
      
      <hr>
      
    
    <section class="item footer">
      <p class="heading">
        本サイトはInternet Explorerをサポートしていません。<br>
        Google ChromeとEdgeでは動作を確認しています<br>
        (上記ブラウザで動作しない場合はバージョンのアップデートを試みてください)<br>
        簡単な確認ツールを用意しました。以下のボタンを押しても何も反応しなければ非対応ブラウザです。<br>
        動作可能ブラウザでは「正常に動作しています」と画面に出ます。
      </p>
      <p class="button" onclick="test()">テスト実行</p>
      </section>
      <p>©2019 yukuduri</p>
      
    </section>
  </body>
</html>